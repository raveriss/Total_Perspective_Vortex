repos:
  # Hygiène de base (YAML/TOML, EOF, espaces)
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      - id: check-yaml
      - id: check-toml
      - id: end-of-file-fixer
        exclude: "(^data/|^artifacts/|^mutants/|\\.(edf|event|npy)$)"
      - id: trailing-whitespace
        exclude: "(^data/|^artifacts/|^mutants/|\\.(edf|event|npy)$)"
      - id: mixed-line-ending
        exclude: "(^data/|^artifacts/|^mutants/|\\.(edf|event|npy)$)"

  # Formatage
  - repo: https://github.com/psf/black
    rev: 25.1.0
    hooks:
      - id: black
        exclude: "^mutants/"

  - repo: https://github.com/pycqa/isort
    rev: 6.0.1
    hooks:
      - id: isort
        exclude: "^mutants/"

  # Lint Python (remplace flake8)
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.12.2
    hooks:
      - id: ruff
        exclude: "^mutants/"

  # Typage (configuration dans pyproject.toml)
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.16.1
    hooks:
      - id: mypy
        pass_filenames: false
        args:
          - "--config-file=pyproject.toml"
          - "src"
          - "scripts"
          - "tests"
        additional_dependencies:
          - pytest
          - hypothesis
          - matplotlib-stubs

  # Sécurité code (Bandit sur src + scripts temps réel)
  - repo: https://github.com/PyCQA/bandit
    rev: 1.8.6
    hooks:
      - id: bandit
        pass_filenames: false
        args:
          - "-r"
          - "src"
          - "scripts"

  # Analyse complexité + mutation testing + tests
  - repo: local
    hooks:
      # Audit dépendances (via l'environnement Poetry local)
      - id: pip-audit
        name: pip-audit
        entry: >-
          bash -c
          "poetry run python -m pip install --upgrade pip &&
          poetry run pip-audit --progress-spinner=off --skip-editable"
        language: system
        pass_filenames: false
        stages: [pre-push]

      # Complexité cyclomatique (radon)
      - id: radon
        name: radon
        entry: radon cc src/tpv scripts --min C
        language: system
        pass_filenames: false

      # Budget de complexité (xenon)
      - id: xenon
        name: xenon
        entry: xenon --max-absolute B --max-modules A --max-average A src/tpv scripts
        language: system
        pass_filenames: false

      # Tests unitaires + coverage (rapide, via Poetry)
      - id: pytest
        name: pytest
        entry: poetry run pytest
        language: system
        pass_filenames: false
        stages: [pre-push]

      # Mutation testing sur le cœur ML/BCI
      - id: mutmut
        name: mutmut
        entry: poetry run mutmut run --paths-to-mutate src/tpv
        language: system
        pass_filenames: false
        stages: [pre-push]
